#!/bin/sh

set -eox

GH_ACCOUNT=jwfh
GH_REPO=freebsd-init

WRKDIR="$(mktemp -d)"

PORTS=	\
	gmake \
	p5-subversion \
	git \
	sudo \
	llvm80 \
	meson \
    "print/ghostscript9-agpl-base DISABLE_VULNERABILITIES=yes" \
    "print/tex-dvipsk" \
	vim

fetch_repo() {
	echo "Fetching files from VCS to ${WRKDIR}"
	cd "${WRKDIR}" && \
		fetch -o- https://api.github.com/repos/${GH_ACCOUNT}/${GH_REPO}/releases/latest \
			| sed -E -e 's@^.*"tarball_url":"@@' -e 's@".*$@@' \
			| xargs fetch -o- \
			| tar xvf - --strip 1
}

install_port_options() {
	echo "Installing port options"
}

install_if_not_exists() {
	echo "Building $1"
}

install_ports() {
	for port in ${PORTS}
	do
		install_if_not_exists ${port}
	done
}

main() {
	fetch_repo
	install_port_options
	install_ports
}

main

rm -rf "${WRKDIR}"
